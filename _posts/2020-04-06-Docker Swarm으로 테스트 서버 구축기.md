---
title: Docker Swarm으로 테스트 서버 구축하기
published: true
permalink: post_2.html
summary: Docker Swarm으로 테스트 서버 구축하기
tags: [Docker, docker, docker swarm, aws, docker-compose]
---

안녕하세요. 개발팀 김형진입니다. 현재 개발되고 있는 투자플랫폼 테스트 서버를 재구축을 해서 거기에 대한 애기를 할려고 합니다.

## 다시 서버를 구축하게 된 경위

현재 개발중인 투자플랫폼 같은 경우 정식으로 런칭이 안되었기 때문에 테스트 서버만 구축이 되어있는 상태였습니다.

그런데 개발되고 있는 투자플랫폼 서비스를 투자자쪽에서 개발상태를 보기를 원했고 문제는 해당서버는 아슬아슬할 정도로 자원을 최대한으로 사용하고 있어 안정적이지 못했습니다.

서버가 안정적이지 못하니 서비스가 죽는 경우가 빈번했고 투자자에게 혹은 다른 사람들에게 소개를 하기 어려웠습니다. 그래서 안정적으로 서버를 바꿔달라는 요청이 있어 서버환경을 수정하게 되었습니다.

## 이전 테스트 서버의 기술 스택

{% include image.html file="posts/2-1.png" caption="프로젝트 구조" %}

기존의 테스트 서버의 경우 하나의 AWS EC2 인스턴스를 사용하였고 배포의 경우 각 프로젝트마다 도커 이미지를 만들 수 있는 Dockerfile이 존재하여 젠킨스에서 프로젝트를 빌드하고 결과물인 jar파일을 Dockerfile에 내용을 바탕으로 도커 이미지를 만들고 도커 컴포즈를 사용하여 프로젝트를 구동하였습니다.

### 문제점

1. 서버가 한대로 해당 서버가 죽으면 해당서비스가 전부 죽는 다.
2. API 서비스 중에 하나가 죽을 경우 자동으로 서비스가 다시 올라가지 않는 다.
3. 에러로그를 수집하는 곳이 없어서 로그를 보기 어렵다.
4. 에러가 났을 경우 노티가 없다.

## 해결방안

1. 서버를 2대로 운영한다.
2. Docker Swarm을 도입한다.
3. ELK을 도입한다.
4. 에러가 났을 경우 채팅프로그램으로 노티를 보낸다.

### 서버를 2대로 운영

경우에 따라 테스트 서버를 실섭으로 변경하고 테스트 서버를 새로 구축할 걸 생각을 하기도 했고 서버가 하나가 죽을 경우를 대비하여 일단은 2대로 구성하기로 했습니다.

### Docker Swarm

* 안정성
* 유지비

레플리카의 갯수를 설정하면 서비스가 죽거나 서버가 죽는 경우에 다른 쪽 서버에서 자동으로 설정한 갯수만큼 자동으로 유지를 해줍니다. 나중에 서버를 확장하거나 축소를 할 수 있습니다.

가장 많이 사용하는 쿠버네티스를 생각하지 않은 것은 아니지만 Swarm보다 무겁고 실섭으로 변경할 계획이 있다고 해도 일단은 테스트 서버이기 때문에 Swarm를 선택하게 되었습니다.

### ELK

## 수정된 테스트서버 예상도

안정된 서버를 구축하기 위해 선택한 기술은 도커스웜이였다.

{% include links.html %}